(function(a,h){typeof module=="object"&&module.exports?module.exports=h():a.EvEmitter=h()})(typeof window!="undefined"?window:this,function(){function a(){}let h=a.prototype;return h.on=function(n,o){if(!n||!o)return this;let i=this._events=this._events||{},d=i[n]=i[n]||[];return d.includes(o)||d.push(o),this},h.once=function(n,o){if(!n||!o)return this;this.on(n,o);let i=this._onceEvents=this._onceEvents||{};return(i[n]=i[n]||{})[o]=!0,this},h.off=function(n,o){let i=this._events&&this._events[n];if(!i||!i.length)return this;let d=i.indexOf(o);return d!=-1&&i.splice(d,1),this},h.emitEvent=function(n,o){let i=this._events&&this._events[n];if(!i||!i.length)return this;i=i.slice(0),o=o||[];let d=this._onceEvents&&this._onceEvents[n];for(let c of i)d&&d[c]&&(this.off(n,c),delete d[c]),c.apply(this,o);return this},h.allOff=function(){return delete this._events,delete this._onceEvents,this},a}),function(a,h){typeof module=="object"&&module.exports?module.exports=h(a,require("ev-emitter")):a.imagesLoaded=h(a,a.EvEmitter)}(typeof window!="undefined"?window:this,function(a,h){let n=a.jQuery,o=a.console;function i(t,e,s){if(!(this instanceof i))return new i(t,e,s);let r=t;var u;typeof t=="string"&&(r=document.querySelectorAll(t)),r?(this.elements=(u=r,Array.isArray(u)?u:typeof u=="object"&&typeof u.length=="number"?[...u]:[u]),this.options={},typeof e=="function"?s=e:Object.assign(this.options,e),s&&this.on("always",s),this.getImages(),n&&(this.jqDeferred=new n.Deferred),setTimeout(this.check.bind(this))):o.error(`Bad element for imagesLoaded ${r||t}`)}i.prototype=Object.create(h.prototype),i.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};const d=[1,9,11];i.prototype.addElementImages=function(t){t.nodeName==="IMG"&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);let{nodeType:e}=t;if(!e||!d.includes(e))return;let s=t.querySelectorAll("img");for(let r of s)this.addImage(r);if(typeof this.options.background=="string"){let r=t.querySelectorAll(this.options.background);for(let u of r)this.addElementBackgroundImages(u)}};const c=/url\((['"])?(.*?)\1\)/gi;function m(t){this.img=t}function p(t,e){this.url=t,this.element=e,this.img=new Image}return i.prototype.addElementBackgroundImages=function(t){let e=getComputedStyle(t);if(!e)return;let s=c.exec(e.backgroundImage);for(;s!==null;){let r=s&&s[2];r&&this.addBackground(r,t),s=c.exec(e.backgroundImage)}},i.prototype.addImage=function(t){let e=new m(t);this.images.push(e)},i.prototype.addBackground=function(t,e){let s=new p(t,e);this.images.push(s)},i.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length)return void this.complete();let t=(e,s,r)=>{setTimeout(()=>{this.progress(e,s,r)})};this.images.forEach(function(e){e.once("progress",t),e.check()})},i.prototype.progress=function(t,e,s){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&o&&o.log(`progress: ${s}`,t,e)},i.prototype.complete=function(){let t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){let e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},m.prototype=Object.create(h.prototype),m.prototype.check=function(){this.getIsImageComplete()?this.confirm(this.img.naturalWidth!==0,"naturalWidth"):(this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src)},m.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},m.prototype.confirm=function(t,e){this.isLoaded=t;let{parentNode:s}=this.img,r=s.nodeName==="PICTURE"?s:this.img;this.emitEvent("progress",[this,r,e])},m.prototype.handleEvent=function(t){let e="on"+t.type;this[e]&&this[e](t)},m.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},m.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},m.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},p.prototype=Object.create(m.prototype),p.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(this.img.naturalWidth!==0,"naturalWidth"),this.unbindEvents())},p.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},p.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},i.makeJQueryPlugin=function(t){(t=t||a.jQuery)&&(n=t,n.fn.imagesLoaded=function(e,s){return new i(this,e,s).jqDeferred.promise(n(this))})},i.makeJQueryPlugin(),i});
