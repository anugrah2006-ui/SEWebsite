var defaultPosts=elementorModules.frontend.handlers.Base.extend({getSkinPrefix:()=>"vamtam_classic_",bindEvents(){elementorFrontend.addListenerOnce(this.getModelCID(),"resize",this.onWindowResize)},unbindEvents(){elementorFrontend.removeListeners(this.getModelCID(),"resize",this.onWindowResize)},getClosureMethodsNames(){return elementorModules.frontend.handlers.Base.prototype.getClosureMethodsNames.apply(this,arguments).concat(["fitImages","onWindowResize","runMasonry"])},getDefaultSettings:()=>({classes:{fitHeight:"elementor-fit-height",hasItemRatio:"elementor-has-item-ratio"},selectors:{postsContainer:".elementor-posts-container",post:".elementor-post",postThumbnail:".elementor-post__thumbnail",postThumbnailImage:".elementor-post__thumbnail img"}}),getDefaultElements(){var o=this.getSettings("selectors");return{$postsContainer:this.$element.find(o.postsContainer),$posts:this.$element.find(o.post)}},fitImage(o){var e=this.getSettings(),t=o.find(e.selectors.postThumbnail),s=t.find("img")[0];if(s){var n=t.outerHeight()/t.outerWidth(),i=s.naturalHeight/s.naturalWidth;t.toggleClass(e.classes.fitHeight,i<n)}},fitImages(){var o=jQuery,e=this,t=getComputedStyle(this.$element[0],":after").content,s=this.getSettings();if(e.isMasonryEnabled()){this.elements.$postsContainer.removeClass(s.classes.hasItemRatio);return}this.elements.$postsContainer.toggleClass(s.classes.hasItemRatio,!!t.match(/\d/)),this.elements.$posts.each(function(){var n=o(this),i=n.find(s.selectors.postThumbnailImage);e.fitImage(n),i.on("load",function(){e.fitImage(n)})})},setColsCountSettings(){let o=this.getElementSettings(),e=this.getSkinPrefix(),t=elementorProFrontend.utils.controls.getResponsiveControlValue(o,`${e}columns`);this.setSettings("colsCount",t)},isMasonryEnabled(){return!!this.getElementSettings(this.getSkinPrefix()+"masonry")},initMasonry(){imagesLoaded(this.elements.$posts,this.runMasonry)},getVerticalSpaceBetween(){let o=elementorProFrontend.utils.controls.getResponsiveControlValue(this.getElementSettings(),`${this.getSkinPrefix()}row_gap`,"size");return this.getSkinPrefix()===""&&o===""&&(o=this.getElementSettings("item_gap.size")),o},runMasonry(){var o=this.elements;o.$posts.css({marginTop:"",transitionDuration:""}),this.setColsCountSettings();var e=this.getSettings("colsCount"),t=this.isMasonryEnabled()&&e>=2;if(o.$postsContainer.toggleClass("elementor-posts-masonry",t),!t){o.$postsContainer.height("");return}let s=this.getVerticalSpaceBetween();new elementorModules.utils.Masonry({container:o.$postsContainer,items:o.$posts.filter(":visible"),columnsCount:this.getSettings("colsCount"),verticalSpaceBetween:s||0}).run()},run(){setTimeout(this.fitImages,0),this.initMasonry()},onInit(){elementorModules.frontend.handlers.Base.prototype.onInit.apply(this,arguments),this.bindEvents(),this.run()},onWindowResize(){this.fitImages(),this.runMasonry()},onElementChange(){this.fitImages(),setTimeout(this.runMasonry)}});class VamtamLoadMore extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{postsContainer:".elementor-posts-container",loadMoreButton:".elementor-button",loadMoreSpinnerWrapper:".e-load-more-spinner",loadMoreSpinner:".e-load-more-spinner i, .e-load-more-spinner svg",loadMoreAnchor:".e-load-more-anchor"},classes:{loadMoreSpin:"eicon-animation-spin",loadMoreIsLoading:"e-load-more-pagination-loading",loadMorePaginationEnd:"e-load-more-pagination-end",loadMoreNoSpinner:"e-load-more-no-spinner"}}}getDefaultElements(){let e=this.getSettings("selectors");return{postsWidgetWrapper:this.$element[0],postsContainer:this.$element[0].querySelector(e.postsContainer),loadMoreButton:this.$element[0].querySelector(e.loadMoreButton),loadMoreSpinnerWrapper:this.$element[0].querySelector(e.loadMoreSpinnerWrapper),loadMoreSpinner:this.$element[0].querySelector(e.loadMoreSpinner),loadMoreAnchor:this.$element[0].querySelector(e.loadMoreAnchor)}}bindEvents(){super.bindEvents(),this.elements.loadMoreButton&&this.elements.loadMoreButton.addEventListener("click",e=>{!this.isLoading&&(e.preventDefault(),this.handlePostsQuery())})}onInit(){super.onInit(),this.classes=this.getSettings("classes"),this.isLoading=!1;let e=this.getElementSettings("pagination_type");(e==="load_more_on_click"||e==="load_more_infinite_scroll")&&(this.isInfinteScroll=e==="load_more_infinite_scroll",this.isSpinnerAvailable=this.getElementSettings("load_more_spinner").value,this.isSpinnerAvailable||this.elements.postsWidgetWrapper.classList.add(this.classes.loadMoreNoSpinner),this.isInfinteScroll?this.handleInfiniteScroll():this.elements.loadMoreSpinnerWrapper&&this.elements.loadMoreButton&&this.elements.loadMoreButton.insertAdjacentElement("beforeEnd",this.elements.loadMoreSpinnerWrapper),this.elementId=this.getID(),this.postId=elementorFrontendConfig.post.id,this.elements.loadMoreAnchor&&(this.currentPage=parseInt(this.elements.loadMoreAnchor.getAttribute("data-page")),this.maxPage=parseInt(this.elements.loadMoreAnchor.getAttribute("data-max-page")),this.currentPage!==this.maxPage&&this.currentPage||this.handleUiWhenNoPosts()))}handleInfiniteScroll(){!this.isEdit&&(this.observer=elementorModules.utils.Scroll.scrollObserver({callback:e=>{e.isInViewport&&!this.isLoading&&(this.observer.unobserve(this.elements.loadMoreAnchor),this.handlePostsQuery().then(()=>{this.currentPage!==this.maxPage&&this.observer.observe(this.elements.loadMoreAnchor)}))}}),this.observer.observe(this.elements.loadMoreAnchor))}handleUiBeforeLoading(){this.isLoading=!0,this.elements.loadMoreSpinner&&this.elements.loadMoreSpinner.classList.add(this.classes.loadMoreSpin),this.elements.postsWidgetWrapper.classList.add(this.classes.loadMoreIsLoading)}handleUiAfterLoading(){this.isLoading=!1,this.elements.loadMoreSpinner&&this.elements.loadMoreSpinner.classList.remove(this.classes.loadMoreSpin),this.isInfinteScroll&&this.elements.loadMoreSpinnerWrapper&&this.elements.loadMoreAnchor&&this.elements.loadMoreAnchor.insertAdjacentElement("afterend",this.elements.loadMoreSpinnerWrapper),this.elements.postsWidgetWrapper.classList.remove(this.classes.loadMoreIsLoading)}handleUiWhenNoPosts(){this.elements.postsWidgetWrapper.classList.add(this.classes.loadMorePaginationEnd)}handleSuccessFetch(e){this.handleUiAfterLoading();let t=e.querySelectorAll(`[data-id="${this.elementId}"] .elementor-posts-container > article`),s=e.querySelector(".e-load-more-anchor").getAttribute("data-next-page"),n=[...t].reduce((i,r)=>i+r.outerHTML,"");this.elements.postsContainer.insertAdjacentHTML("beforeend",n),this.elements.loadMoreAnchor.setAttribute("data-page",this.currentPage),this.elements.loadMoreAnchor.setAttribute("data-next-page",s),this.currentPage===this.maxPage&&this.handleUiWhenNoPosts(),setTimeout(()=>{jQuery(window).trigger("resize")},10)}handlePostsQuery(){this.handleUiBeforeLoading(),this.currentPage++;let e=new URL(this.elements.loadMoreAnchor.getAttribute("data-next-page"));return e.searchParams.set("vamtam_posts_fetch",1),fetch(e.toString()).then(t=>t.text()).then(t=>{let s=new DOMParser,n=s.parseFromString(t,"text/html");this.handleSuccessFetch(n)}).catch(t=>{console.warn("Something went wrong.",t)})}}class VamtamMasonry extends elementorModules.frontend.handlers.Base{onInit(){elementorModules.frontend.handlers.Base.prototype.onInit.apply(this,arguments),this.bindEvents(),this.loadMoreMasonryFix(),this.checkApplySafariFix()}checkApplySafariFix(){let e=this;jQuery(window).on("load",()=>{jQuery("html").hasClass("safari")&&setTimeout(()=>{e.onWindowResize()},10)})}recalculateMasonry(){this.elements=this.getDefaultElements(),this.onWindowResize()}checkDiscardDuplicates(){let e=this.$element,t=e.find(".elementor-posts-container"),s=t.find(".elementor-post:visible"),n=jQuery(".vamtam-blog-featured-post .elementor-post:visible"),i=[],r=[],m=0;if(s.length){if(jQuery.each(s,(l,d)=>{let a=parseInt(s[l].classList[2].match(/\d+/)[0]);a&&!isNaN(a)&&(i.indexOf(a)===-1?i.push(a):(jQuery(d).remove(),m++))}),n.length){jQuery.each(n,d=>{let a=parseInt(n[d].classList[2].match(/\d+/)[0]);a&&!isNaN(a)&&r.indexOf(a)===-1&&r.push(a)});let l=t.find(".elementor-post:visible");jQuery.each(l,(d,a)=>{let h=parseInt(l[d].classList[2].match(/\d+/)[0]);h&&!isNaN(h)&&r.indexOf(h)!==-1&&(jQuery(a).remove(),m++)})}return m}}loadMoreMasonryFix(){let e=this.getElementSettings().pagination_type;if(e!=="load_more_on_click"&&e!=="load_more_infinite_scroll")return;var t=this.$element,s=t.find(".elementor-posts-container"),n=t.find(".elementor-button"),i=t.find(".e-load-more-anchor"),r=null,m=null,l=null,d=this;let a=()=>{e==="load_more_on_click"?jQuery(n).off("click",h):l.disconnect()},h=()=>{r=s.find(".elementor-post:visible").length;let c=!1,g=setInterval(()=>{if(r!==(m=s.find(".elementor-post:visible").length)){let p=d.checkDiscardDuplicates();d.recalculateMasonry(),r=m-p,clearInterval(g),c=!0,l&&l.observe(i[0])}t.hasClass("e-load-more-pagination-end")&&a()},50);c||setTimeout(()=>{clearInterval(g)},1e4)};e==="load_more_on_click"?jQuery(n).on("click",h):!this.isEdit&&(l=elementorModules.utils.Scroll.scrollObserver({callback(c){c.isInViewport&&(l.unobserve(i[0]),h())}})).observe(i[0])}getSkinPrefix(){var e,t;if(this.skinPrefix)return this.skinPrefix;let s=(t=(e=this.getSettings())==null?void 0:e.elementName)==null?void 0:t.split(".")[1];return s?(this.skinPrefix=s+"_",this.skinPrefix):"vamtam_classic_"}bindEvents(){var e=this.getModelCID();elementorFrontend.addListenerOnce(e,"resize",this.onWindowResize.bind(this))}getClosureMethodsNames(){return elementorModules.frontend.handlers.Base.prototype.getClosureMethodsNames.apply(this,arguments).concat(["fitImages","onWindowResize","runMasonry"])}getDefaultSettings(){return{classes:{fitHeight:"elementor-fit-height",hasItemRatio:"elementor-has-item-ratio"},selectors:{postsContainer:".elementor-posts-container",post:".elementor-post",postThumbnail:".elementor-post__thumbnail",postThumbnailImage:".elementor-post__thumbnail img"}}}getDefaultElements(){var e=this.getSettings("selectors");return{$postsContainer:this.$element.find(e.postsContainer),$posts:this.$element.find(e.post)}}fitImage(e){var t=this.getSettings(),s=e.find(t.selectors.postThumbnail),n=s.find("img")[0];if(n){var i=s.outerHeight()/s.outerWidth(),r=n.naturalHeight/n.naturalWidth;s.toggleClass(t.classes.fitHeight,r<i)}}fitImages(){var e=jQuery,t=this,s=getComputedStyle(this.$element[0],":after").content,n=this.getSettings();this.elements.$postsContainer.toggleClass(n.classes.hasItemRatio,!!s.match(/\d/)),!t.isMasonryEnabled()&&this.elements.$posts.each(function(){var i=e(this),r=i.find(n.selectors.postThumbnailImage);t.fitImage(i),r.on("load",function(){t.fitImage(i)})})}setColsCountSettings(){var e,t=elementorFrontend.getCurrentDeviceMode(),s=this.getElementSettings(),n=this.getSkinPrefix();switch(t){case"mobile":e=s[n+"columns_mobile"];break;case"tablet":e=s[n+"columns_tablet"];break;default:e=s[n+"columns"]}this.setSettings("colsCount",e)}isMasonryEnabled(){return!!this.getElementSettings(this.getSkinPrefix()+"masonry")}runMasonry(){var e=this.elements;e.$posts.css({marginTop:"",transitionDuration:""}),this.setColsCountSettings();var t=this.getSettings("colsCount"),s=this.isMasonryEnabled()&&t>=2;if(e.$postsContainer.toggleClass("elementor-posts-masonry",s),!s){e.$postsContainer.height("");return}var n=this.getElementSettings(this.getSkinPrefix()+"row_gap.size");this.getSkinPrefix()===""&&n===""&&(n=this.getElementSettings(this.getSkinPrefix()+"item_gap.size")),new elementorModules.utils.Masonry({container:e.$postsContainer,items:e.$posts.filter(":visible"),columnsCount:this.getSettings("colsCount"),verticalSpaceBetween:n}).run()}onWindowResize(){this.fitImages(),this.runMasonry()}}jQuery(window).on("elementor/frontend/init",()=>{if(elementorFrontend.elementsHandler&&elementorFrontend.elementsHandler.attachHandler)VAMTAM_FRONT.elementor.widgets.isWidgetModActive("posts")&&(elementorFrontend.elementsHandler.attachHandler("posts",defaultPosts,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("posts",VamtamLoadMore,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("posts",VamtamMasonry,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("posts",VamtamMasonry,"classic")),VAMTAM_FRONT.elementor.widgets.isWidgetModActive("archive-posts")&&(elementorFrontend.elementsHandler.attachHandler("archive-posts",defaultPosts,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("archive-posts",VamtamLoadMore,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("archive-posts",VamtamMasonry,"vamtam_classic"),elementorFrontend.elementsHandler.attachHandler("archive-posts",VamtamMasonry,"archive_classic"));else{let o=s=>{elementorFrontend.elementsHandler.addHandler(defaultPosts,{$element:s})},e=s=>{elementorFrontend.elementsHandler.addHandler(VamtamLoadMore,{$element:s})},t=s=>{elementorFrontend.elementsHandler.addHandler(VamtamMasonry,{$element:s})};VAMTAM_FRONT.elementor.widgets.isWidgetModActive("posts")&&(elementorFrontend.hooks.addAction("frontend/element_ready/posts.vamtam_classic",o,100),elementorFrontend.hooks.addAction("frontend/element_ready/posts.vamtam_classic",e,100),elementorFrontend.hooks.addAction("frontend/element_ready/posts.vamtam_classic",t,100),elementorFrontend.hooks.addAction("frontend/element_ready/posts.classic",t,100)),VAMTAM_FRONT.elementor.widgets.isWidgetModActive("archive-posts")&&(elementorFrontend.hooks.addAction("frontend/element_ready/archive-posts.vamtam_classic",o,100),elementorFrontend.hooks.addAction("frontend/element_ready/archive-posts.vamtam_classic",e,100),elementorFrontend.hooks.addAction("frontend/element_ready/archive-posts.vamtam_classic",t,100),elementorFrontend.hooks.addAction("frontend/element_ready/archive-posts.classic",t,100))}});
